<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registration Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        .success {
            color: green;
            margin: 10px 0;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Test Registration & Login Flows</h1>
    
    <div class="section">
        <h2>1. Test College Registration</h2>
        <button onclick="testCollegeRegistration()">Register Test College</button>
        <div id="college-result"></div>
    </div>

    <div class="section">
        <h2>2. Test User Registration</h2>
        <input type="text" id="college-code" placeholder="Enter college code">
        <button onclick="testUserRegistration()">Register Test User</button>
        <div id="user-result"></div>
    </div>

    <div class="section">
        <h2>3. Check localStorage Data</h2>
        <button onclick="checkLocalStorage()">Check Storage</button>
        <div id="storage-result"></div>
    </div>

    <div class="section">
        <h2>4. Clear All Data</h2>
        <button onclick="clearAllData()">Clear Everything</button>
        <div id="clear-result"></div>
    </div>

    <script>
        function testCollegeRegistration() {
            const resultDiv = document.getElementById('college-result');
            
            // Generate test data
            const timestamp = Date.now();
            const collegeData = {
                name: `Test College ${timestamp}`,
                address: '123 Test Street',
                contact_email: `college${timestamp}@test.com`,
                contact_phone: '1234567890',
                admin_email: `admin${timestamp}@test.com`,
                admin_password: 'test123',
                admin_name: `Admin ${timestamp}`
            };

            // Simulate registration
            const collegeId = `college_${timestamp}`;
            const collegeCode = `COL-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
            
            const college = {
                id: collegeId,
                code: collegeCode,
                name: collegeData.name,
                address: collegeData.address,
                contact_email: collegeData.contact_email,
                contact_phone: collegeData.contact_phone,
                admin_id: `admin_${timestamp}`,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            const adminProfile = {
                id: college.admin_id,
                username: collegeData.admin_email,
                full_name: collegeData.admin_name,
                role: 'admin',
                college_id: collegeId,
                group_ids: [],
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            // Save to localStorage
            const colleges = JSON.parse(localStorage.getItem('demo_colleges') || '[]');
            colleges.push(college);
            localStorage.setItem('demo_colleges', JSON.stringify(colleges));

            const users = JSON.parse(localStorage.getItem('demo_users') || '[]');
            users.push({ ...adminProfile, password: collegeData.admin_password });
            localStorage.setItem('demo_users', JSON.stringify(users));

            localStorage.setItem('demo_current_user', JSON.stringify(adminProfile));
            localStorage.setItem('demo_auth_token', 'demo_token_' + timestamp);

            resultDiv.innerHTML = `
                <div class="success">✅ College registered successfully!</div>
                <pre>College Code: ${collegeCode}
Admin Email: ${collegeData.admin_email}
Admin Password: ${collegeData.admin_password}</pre>
            `;

            // Auto-fill college code for user registration
            document.getElementById('college-code').value = collegeCode;
        }

        function testUserRegistration() {
            const resultDiv = document.getElementById('user-result');
            const collegeCode = document.getElementById('college-code').value;

            if (!collegeCode) {
                resultDiv.innerHTML = '<div class="error">❌ Please enter a college code</div>';
                return;
            }

            // Check if college exists
            const colleges = JSON.parse(localStorage.getItem('demo_colleges') || '[]');
            const college = colleges.find(c => c.code === collegeCode);

            if (!college) {
                resultDiv.innerHTML = '<div class="error">❌ Invalid college code</div>';
                return;
            }

            // Generate test user data
            const timestamp = Date.now();
            const userData = {
                email: `user${timestamp}@test.com`,
                password: 'test123',
                full_name: `Test User ${timestamp}`,
                role: 'student',
                college_code: collegeCode
            };

            const userProfile = {
                id: `user_${timestamp}`,
                username: userData.email,
                full_name: userData.full_name,
                role: userData.role,
                college_id: college.id,
                group_ids: [],
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            // Save to localStorage
            const users = JSON.parse(localStorage.getItem('demo_users') || '[]');
            users.push({ ...userProfile, password: userData.password });
            localStorage.setItem('demo_users', JSON.stringify(users));

            resultDiv.innerHTML = `
                <div class="success">✅ User registered successfully!</div>
                <pre>Email: ${userData.email}
Password: ${userData.password}
Role: ${userData.role}</pre>
            `;
        }

        function checkLocalStorage() {
            const resultDiv = document.getElementById('storage-result');
            
            const data = {
                currentUser: localStorage.getItem('demo_current_user'),
                authToken: localStorage.getItem('demo_auth_token'),
                colleges: localStorage.getItem('demo_colleges'),
                users: localStorage.getItem('demo_users'),
                classrooms: localStorage.getItem('demo_classrooms')
            };

            let html = '<h3>localStorage Contents:</h3>';
            for (const [key, value] of Object.entries(data)) {
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        html += `<h4>${key}:</h4><pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                    } catch {
                        html += `<h4>${key}:</h4><pre>${value}</pre>`;
                    }
                } else {
                    html += `<h4>${key}:</h4><p>Not set</p>`;
                }
            }

            resultDiv.innerHTML = html;
        }

        function clearAllData() {
            const keys = [
                'demo_current_user',
                'demo_auth_token',
                'demo_colleges',
                'demo_users',
                'demo_classrooms',
                'demo_polls',
                'demo_quizzes',
                'demo_live_lectures'
            ];

            keys.forEach(key => localStorage.removeItem(key));

            document.getElementById('clear-result').innerHTML = 
                '<div class="success">✅ All data cleared!</div>';
        }
    </script>
</body>
</html>
